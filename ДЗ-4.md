## Создать таблицу accounts(id integer, amount numeric);

```sql
create table accounts(id integer, amount numeric);
```

## Добавить несколько записей и подключившись через 2 терминала добиться ситуации взаимоблокировки (deadlock).

```sql
insert into accounts(id, amount) values(1, 100.00),(2,200.00),(3,300.00);
```

## запустил в первом терминале

```sql
begin; update accounts set amount=250 where id=2;

output:
BEGIN
UPDATE 1

```

запустил во втором терминале

```sql
begin; update accounts set amount=350 where id=3;

output:	
BEGIN
UPDATE 1
```

запустил в первом терминале

```sql
update accounts set amount=250 where id=3;
	
output:	
UPDATE 1
```

запустил во втором терминале

```sql
update accounts set amount=350 where id=2;

output:	


WARNING:  there is already a transaction in progress
BEGIN
ERROR:  deadlock detected
DETAIL:  Process 60 waits for ShareLock on transaction 767; blocked by process 62.
Process 62 waits for ShareLock on transaction 768; blocked by process 60.
HINT:  See server log for query details.
CONTEXT:  while updating tuple (0,2) in relation "accounts"

```



## Посмотреть логи и убедиться, что информация о дедлоке туда попала.


```logs

2024-10-13 10:42:43.677 UTC [62] LOG:  statement: rollback;
2024-10-13 10:42:43.678 UTC [62] WARNING:  there is no transaction in progress
2024-10-13 10:42:50.220 UTC [62] LOG:  statement: begin;
2024-10-13 10:43:03.112 UTC [62] LOG:  statement: update accounts set amount=250 where id=2;
2024-10-13 10:43:29.156 UTC [60] LOG:  statement: begin;
2024-10-13 10:43:29.156 UTC [60] LOG:  statement: update accounts set amount=350 where id=3;
2024-10-13 10:43:35.929 UTC [62] LOG:  statement: update accounts set amount=250 where id=3;
2024-10-13 10:43:40.320 UTC [60] LOG:  statement: begin;
2024-10-13 10:43:40.320 UTC [60] WARNING:  there is already a transaction in progress
2024-10-13 10:43:40.320 UTC [60] LOG:  statement: update accounts set amount=350 where id=2;
2024-10-13 10:43:41.322 UTC [60] ERROR:  deadlock detected
2024-10-13 10:43:41.322 UTC [60] DETAIL:  Process 60 waits for ShareLock on transaction 767; blocked by process 62.
	Process 62 waits for ShareLock on transaction 768; blocked by process 60.
	Process 60: update accounts set amount=350 where id=2;
	Process 62: update accounts set amount=250 where id=3;
2024-10-13 10:43:41.322 UTC [60] HINT:  See server log for query details.
2024-10-13 10:43:41.322 UTC [60] CONTEXT:  while updating tuple (0,2) in relation "accounts"
2024-10-13 10:43:41.322 UTC [60] STATEMENT:  update accounts set amount=350 where id=2;
2024-10-13 10:44:51.071 UTC [28] LOG:  checkpoint starting: time
2024-10-13 10:44:51.422 UTC [28] LOG:  checkpoint complete: wrote 6 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.322 s, sync=0.012 s, total=0.352 s; sync files=4, longest=0.008 s, average=0.003 s; distance=1 kB, estimate=1 kB; lsn=1/AEB10E60, redo lsn=1/AEB10E28


```


